# linkedin-capi-tag-template

A Google Tag Manager (GTM) tag template that can be utilized to begin streaming conversion events to LinkedIn's Conversion API endpoint.

Further documentation can be found here: https://learn.microsoft.com/en-us/linkedin/marketing/integrations/ads-reporting/conversions-api

## Tag configuration :

- apiAccessToken (required) - GTM access token generated via LinkedIn Campaign Manager _Required_
- apiVersion (required) - e.g. 202402 - should not be more than 12 months from current data _Required_
- conversionRuleUrn (required) - CAPI Conversion Rule ID defined in LinkedIn Campaign Manager _Required_
- eventId (optional) - unique id generated by advertisers to indicate each event _Optional_
- conversionValue (optional) - The monetary value for this conversion. It contains “currencyCode” in ISO format (e.g. “USD”) and the “amount” value of the conversion in decimal string. (e.g. “100.05”). Advertisers can set conversion values dynamically here or set a fix value. ie: '{"currencyCode": "USD", "amount": "50.0"}' _Optional_

## How to pass user parameters from your apps :

```
// User parameters must be passed in "user_data" following Google Common Event Data Model :
// https://developers.google.com/tag-platform/tag-manager/server-side/common-event-data
gtag('set', 'user_data', {
// Standard fields
email_address: formData.get('email'), // required by CAPI if you don't send linkedinFirstPartyId, acxiomID, moatID
//sha256_email_address: hashedEmail, // required, if you don't send hasedh email, LinkedIn CAPI TAG template will hash email_address for you
//phone: formData.get('phoneNumber'), // not required by CAPI
//sha256_phone_number: hashedPhoneNumber, // not required by CAPI
address: {
first_name: formData.get('firstName'), // optional for CAPI
last_name: formData.get('lastName'), // optional for CAPI
country: formData.get('countryCode') // optional for CAPI
},
// Non-standard fields
jobTitle: formData.get('title'), // optional for CAPI
companyName: formData.get('company'), // optional for CAPI
LinkedinFirstPartyId: li_fat_id, // required by CAPI if you don't send email, acxiomID, moatID
acxiomID: formData.get('acxiomID'), // optional for CAPI
moatID: formData.get('moatID'), // optional for CAPI
leadID: formData.get('leadID') // optional for CAPI
})
```

## Pushing event name and conversion value to data layer

```
// Conversion value must be passed in event data parameters for that event instance:
window.dataLayer = window.dataLayer || []
dataLayer.push({
event: 'capi_form_submit', // user defined event name
currency: formData.get('currency'), // optional for CAPI
value: formData.get('value') // optional for CAPI
})
```

## Best practice

1. If you don't capture optional parameters, don't send it in your apps.
2. If you send email_address but not send sha256_email_address, CAPI Tag will hash it for you.
3. You must provide at least 1 of the following userIds, otherwise the api will fail :

- sha256_email_address
- linkedinFirstPartyId
- acxiomID
- moatID

4. If you implement deduplication, pass event_id as event data parameter for that event instance, otherwise don;t send it in your apps
5. LinkedinFirstPartyId can be send in "user_data" by gtag function, or you can send it as user parameter within GTM Web container!
